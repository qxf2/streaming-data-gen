<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>FastAPI Data Streaming App</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <style>
        .graph {
            width: 100%;
            height: 400px;
            margin: 20px 0;
        }
        .tabs {
            display: flex;
            flex-direction: column;
        }
        .tab-buttons {
            display: flex;
            justify-content: space-around;
        }
        .tab-buttons button {
            padding: 10px;
            margin: 5px;
            cursor: pointer;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0,0,0);
            background-color: rgba(0,0,0,0.4);
            padding-top: 60px;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <nav class="container-fluid">
        <ul>
            <li><strong>FastAPI Data Streaming App</strong></li>
        </ul>
        <ul>
            <li><a href="#intro">Home</a></li>
            <li><a href="#endpoints">Endpoints</a></li>
            <li><a href="#tryout" role="button">Try it Out</a></li>
        </ul>
    </nav>

    <section id="intro" style="text-align: center; margin-bottom: 2em;">
        <hgroup>
            <h2>Welcome to FastAPI Data Streaming App</h2>
            <h3>Real-time data streaming and waveform generation</h3>
        </hgroup>
        <p>This application allows you to stream various waveforms and distributions through HTTP endpoints. Use the sections below to learn more about the available endpoints and try them out directly from this page.</p>
        <figure>
            <img src="intro_image_url" alt="Introduction Image" />
            <figcaption><a href="https://github.com/qxf2/streaming-data-gen" target="_blank">GitHub Repository</a></figcaption>
        </figure>
    </section>

    <main class="container">
        <div class="grid">
            <section id="endpoints">
                <hgroup>
                    <h2>Endpoints</h2>
                    <h3>Available Streaming Data Endpoints</h3>
                </hgroup>
                <p>Explore the various endpoints provided by our application. Each endpoint allows you to stream different types of data.</p>
                <div class="tabs">
                    <div class="tab-buttons">
                        <button onclick="openTab(event, 'regular-streams')">Regular Data Streams</button>
                        <button onclick="openTab(event, 'anomalous-streams')">Anomalous Data Streams</button>
                    </div>

                    <div id="regular-streams" class="tab-content">
                        <h3>Regular Data Streams</h3>
                        <button onclick="openModal('sineModal')">/sine</button>
                        <button onclick="openModal('cosineModal')">/cosine</button>
                        <button onclick="openModal('squareModal')">/square</button>
                        <button onclick="openModal('sawtoothModal')">/sawtooth</button>
                        <button onclick="openModal('normalModal')">/normal</button>
                        <button onclick="openModal('uniformModal')">/uniform</button>
                        <button onclick="openModal('exponentialModal')">/exponential</button>
                    </div>
                    <div id="anomalous-streams" class="tab-content">
                        <h3>Anomalous Data Streams</h3>
                        <button onclick="openModal('randomModal')">/anomalies/random</button>
                        <button onclick="openModal('randomSquareModal')">/anomalies/random-square</button>
                        <button onclick="openModal('clusteredModal')">/anomalies/clustered</button>
                        <button onclick="openModal('periodicSpikeModal')">/anomalies/periodic-spike</button>
                        <button onclick="openModal('countPerDurationModal')">/anomalies/count-per-duration</button>
                    </div>
                    
                </div>
            </section>

            <section id="tryout">
                <hgroup>
                    <h2>Try it Out</h2>
                    <h3>Interact with the Endpoints</h3>
                </hgroup>
                <form id="endpointForm" class="grid">
                    <input type="text" id="endpoint" name="endpoint" placeholder="Endpoint (e.g., /sine-wave)" aria-label="Endpoint" required />
                    <input type="text" id="params" name="params" placeholder="Parameters (e.g., frequency=1&amplitude=1)" aria-label="Parameters" />
                    <button type="submit">Submit</button>
                </form>
                <div id="streamingData" class="graph" style="overflow: auto; height: 400px; border: 1px solid #ccc; padding: 10px;">
                    <h4>Streaming Data:</h4>
                    <pre id="dataOutput"></pre>
                </div>
            </section>
            
            

        </div>
    </main>

    <footer class="container">
        <small><a href="https://github.com/qxf2/streaming-data-gen">GitHub</a> â€¢ <a href="https://datagen.pythonanywhere.com/docs">API Docs</a></small>
    </footer>

    <!-- Modal Structure -->
    <!-- Modal Structure for Sine Wave -->
    <div id="sineModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('sineModal')">&times;</span>
            <h2>Sine Wave Endpoint Details</h2>
            <p><strong>Overview:</strong> The sine wave approach generates a continuous stream of data points that follow a sinusoidal pattern. This method is useful for simulating smooth, periodic oscillations in data, commonly observed in various natural and man-made systems.</p>
            <h3>How It Works</h3>
            <p>Generates data points that form a sine wave, characterized by its amplitude, frequency, and phase. The amplitude determines the height of the wave, the frequency defines the number of cycles per second, and the phase sets the wave's horizontal shift. Data points are produced at a specified sample rate, with each point separated by a fixed interval.</p>
            <h3>Key Parameters</h3>
            <ul>
                <li><strong>amplitude (float):</strong> Default: 4.0 - The distance from the height of a peak to the center line, representing the wave's strength.</li>
                <li><strong>frequency (float):</strong> Default: 2.0 - The number of cycles per second of the sine wave, measured in Hertz.</li>
                <li><strong>phase (int):</strong> Default: 0 - The offset of the sine wave, in degrees, determining where the wave starts.</li>
                <li><strong>sample_rate (int):</strong> Default: 100 - The frequency at which data points are generated, measured in samples per second.</li>
                <li><strong>interval (float):</strong> Default: 1.0 - The time interval between each data point, controlling the generation rate.</li>
            </ul>
        </div>
    </div>

<!-- Repeat similar structure for other modals -->


<script>
    document.getElementById('endpointForm').addEventListener('submit', function (event) {
        event.preventDefault();
        console.log("Form submitted");

        const endpoint = document.getElementById('endpoint').value;
        const params = document.getElementById('params').value;
        
        // Print endpoint and params values
        console.log("Endpoint:", endpoint);
        console.log("Parameters:", params);

        // Construct the URL with optional parameters
        const baseUrl = 'http://datagen.pythonanywhere.com';
        const url = `${baseUrl}${endpoint}${params ? '?' + params : ''}`;
        
        // Use a CORS proxy for the request
        // const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
        // const proxiedUrl = `${proxyUrl}${url}`;

        // Print constructed URL
        console.log("Final URL:", url);

        startStreaming(url);
    });

    function startStreaming(url) {
        const dataOutput = document.getElementById('dataOutput');
        dataOutput.innerHTML = '';  // Clear previous data

        console.log("Starting fetch request to URL:", url);

        fetch(url)
            .then(response => {
                console.log("Fetch response received", response);
                if (response.ok) {
                    const reader = response.body.getReader();
                    const decoder = new TextDecoder("utf-8");

                    return new ReadableStream({
                        start(controller) {
                            function push() {
                                reader.read().then(({ done, value }) => {
                                    if (done) {
                                        console.log("Stream complete");
                                        controller.close();
                                        return;
                                    }

                                    // Decode the chunk and append it to the output
                                    const decodedValue = decoder.decode(value, { stream: true });
                                    dataOutput.innerHTML += decodedValue + "\n";
                                    console.log("Received chunk:", decodedValue);
                                    push();
                                }).catch(error => {
                                    console.error('Streaming error:', error);
                                    dataOutput.innerHTML += `Error: ${error.message}`;
                                });
                            }

                            push();
                        }
                    });
                } else {
                    dataOutput.innerHTML = `Failed to connect, status code: ${response.status}`;
                    console.error('Connection failed, status code:', response.status);
                }
            })
            .catch(error => {
                console.error('Fetch error:', error);
                dataOutput.innerHTML = `Request failed: ${error.message}`;
            });
    }
</script>



<script>
    document.getElementById('endpointForm').addEventListener('submit', function (event) {
        event.preventDefault();
        const endpoint = document.getElementById('endpoint').value;
        const params = document.getElementById('params').value;

        // Construct the URL with optional parameters
        const url = `https://datagen.pythonanywhere.com${endpoint}${params ? '?' + params : ''}`;
        startStreaming(url);
    });

    function startStreaming(url) {
        const dataOutput = document.getElementById('dataOutput');
        dataOutput.innerHTML = '';  // Clear previous data

        fetch(url)
            .then(response => {
                if (response.ok) {
                    const reader = response.body.getReader();
                    const decoder = new TextDecoder("utf-8");

                    return new ReadableStream({
                        start(controller) {
                            function push() {
                                reader.read().then(({ done, value }) => {
                                    if (done) {
                                        controller.close();
                                        return;
                                    }

                                    // Decode the chunk and append it to the output
                                    const decodedValue = decoder.decode(value, { stream: true });
                                    dataOutput.innerHTML += decodedValue + "\n";
                                    push();
                                }).catch(error => {
                                    console.error('Streaming error:', error);
                                    dataOutput.innerHTML += `Error: ${error.message}`;
                                });
                            }

                            push();
                        }
                    });
                } else {
                    dataOutput.innerHTML = `Failed to connect, status code: ${response.status}`;
                }
            })
            .catch(error => {
                dataOutput.innerHTML = `Request failed: ${error.message}`;
            });
    }
</script>




</body>

</html>
